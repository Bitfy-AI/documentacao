# Conven√ß√£o de Nomenclatura - Camadas e Workflows

> **Vers√£o:** 2.0.0
> **Protocolo:** Zion
> **Padr√£o:** Arquitetura em Camadas
> **Baseado em:** INT-CNX-001 (Implementa√ß√£o Real)

## üî∑ Mapeamento Oct√≥gono Zion ‚ÜîÔ∏è Camadas

### Como o Oct√≥gono se relaciona com as Camadas

| Step Oct√≥gono | Camada Principal | Prefixo | Cor n8n | Exemplo Real (INT-CNX-001) |
|---------------|------------------|---------|---------|---|
| 1. RECEBE | (A) Interface | `A:` | üü† color:2 | `A:Recebe dados conexao` |
| 2. RASTREIA | Mesma camada | `RAS:` | ‚¨ú color:7 | `RAS:Execu√ß√£o tratador` |
| 3. VALIDA | Mesma camada | `VAL:` | üü¢ color:4 | `VAL:ParametrosValidos` |
| 4. ROTEIA | Mesma camada | `ROT:` | üîµ color:5 | `ROT:SelecionaEstrategiaQuery` |
| 5. PROCESSA | (B) Normaliza√ß√£o + (C) Processamento | `B:` `C:` | üü° color:3 | `B:NOR:Conexao > sistema` |
| 6. AGREGA | (E) Integra√ß√£o ou local | `E:AGG:` `AGG:` | ‚¨ú color:7 | `E:AGG:Debouncer` |
| 7. CONFIRMA | Mesma camada | `VAL:` | üü¢ color:4 | `VAL:Dados Validos Processador` |
| 8. ENTREGA | (C) Processamento | `C:` | üü† color:2 | `C:CMP:Executa motor de resposta` |

## üèóÔ∏è Estrutura de Camadas

### Nomenclatura de Workflows

#### **COM LETRA - Chamada Entre Camadas**
Quando um node executa um workflow de OUTRA camada via `executeWorkflow`:
```
[LETRA]:[CONTEXTO]:[DESCRI√á√ÉO]
```

**Exemplos Reais do INT-CNX-001:**

```javascript
// üü† (A) Interface - Camada de entrada
"A:Recebe dados conexao"  // Webhook que recebe de WhatsApp/Telegram
// Node: webhook (type: n8n-nodes-base.webhook)
// Position: [896, 752]
// Sticky Note: color:2 (laranja)

// üü° (B) Normaliza√ß√£o - Transforma√ß√£o de dados
"B:NOR:Conexao > sistema"       // Normaliza body para formato interno
"B:NOR:Conexao > funcionalidades" // Adapta funcionalidades por conex√£o
// Node: executeWorkflow para camada B
// WorkflowId: Krdi6CaDNjI1Wtln (Adaptador)
// Position: [1792, 544]

// üîµ (C) Processamento - Motor principal
"C:CMP:Executa motor de resposta" // Core do processamento
"C2:MensagemHistorico"           // Componente secund√°rio (disabled)
// Node: executeWorkflow para camada C
// WorkflowId: yKZ3SmJXgtveMZGt (Processador)
// Position: [4080, 368]

// üü£ (D) Intelig√™ncia - IA/LLMs
// Ainda n√£o implementado no INT-CNX-001
// Futuramente: "D:LLM:GPT4", "D:AI:Claude"

// üî¥ (E) Integra√ß√£o - Servi√ßos externos
"E:CNV:Converte midia em texto"   // Converte √°udio/imagem
"E:INT:Buscar servicos no banco"  // Busca integra√ß√µes no DB
"E:BCO:Busca entidade agente"     // Query no banco
"E:AGG:Debouncer"                 // Agregador com delay
// Node: executeWorkflow para camada E
// WorkflowId: pbb2dCaOXY6t8zGw (Tradutor M√≠dias)
// Position: [2896, 384]

// ‚¨ú (F) Observabilidade - Monitoramento
// Ainda n√£o implementado no INT-CNX-001
// Futuramente: "F:LOG:Eventos", "F:MET:Performance"
```

#### **SEM LETRA - Opera√ß√£o Interna**
Quando o node opera DENTRO da mesma camada (n√£o chama outro workflow):
```
[TIPO]:[DESCRI√á√ÉO]
```

**Exemplos Reais do INT-CNX-001:**

```javascript
// ‚úÖ Valida√ß√µes internas (type: if/switch)
"VAL:ParametrosValidos"            // Position: [1344, 752]
"VAL:Agente deve continuar?"       // Position: [2224, 544]
"VAL:Agente deve processar midia?" // Position: [2448, 464]
"VAL:Dados Validos Processador"    // Position: [3824, 480]

// üîÄ Roteamento interno (type: switch)
"ROT:SelecionaEstrategiaQuery"     // Position: [1552, 656]
// Outputs: query | params

// üìç Rastreamento interno (type: executionData)
"RAS:Execu√ß√£o tratador"            // Position: [1120, 752]
// Salva: control, company, connection

// üîó Agrega√ß√£o interna (type: noOp)
"AGG:UnificaMidia"                 // Position: [3152, 480]

// ‚ùå Erros internos (type: stopAndError)
"ERR:Parametros"                   // Position: [1792, 752]
// Message: "A Jana nao funciona mais com params, somente com query."

"ERR: Conexao inexistente"         // Position: [1552, 864]
// Message: "Conflito de par√¢metros: connection e company n√£o foram inseridos"

"ERR: Invalido"                    // Position: [4080, 592]
// Message: "Invalido"
```

## üìÅ Estrutura de Reposit√≥rio

### Padr√£o de Nome de Arquivo
```
[tipo]-[contexto]-[descri√ß√£o] ([C√ìDIGO]).json
```

**Exemplo:**
```
interface-conexao-webhook (INT-CNX-001).json
```

### Decomposi√ß√£o:
- `interface` - Tipo/Camada
- `conexao` - Contexto
- `webhook` - Descri√ß√£o espec√≠fica
- `INT-CNX-001` - C√≥digo √∫nico

## üî§ Mapeamento de Letras para Camadas

| Letra | Camada | Descri√ß√£o | Pastas no n8n |
|-------|--------|-----------|---------------|
| **A** | Interface | Entrada de dados, webhooks, APIs | `(A) Interface` |
| **B** | Normaliza√ß√£o | Transforma√ß√µes, adaptadores | `(B) Normaliza√ß√£o` |
| **C** | Processamento | L√≥gica principal, motor de neg√≥cio | `(C) Processamento` |
| **D** | Intelig√™ncia | IA, LLMs, an√°lise | `(D) Intelig√™ncia` |
| **E** | Integra√ß√£o | Servi√ßos externos, APIs, bancos | `(E) Integra√ß√£o` |
| **F** | Observabilidade | Logs, m√©tricas, monitoring | `(F) Observabilidade` |

## üéØ Regras de Uso

### ‚úÖ USE LETRA quando:
1. Node do tipo `executeWorkflow`
2. Chama workflow de outra camada
3. Precisa isolar responsabilidades
4. Requer processamento em outro contexto

### ‚ùå N√ÉO USE LETRA quando:
1. Opera√ß√£o dentro da mesma camada
2. Nodes de valida√ß√£o simples (`if`, `switch`)
3. Transforma√ß√µes locais (`set`, `function`)
4. Roteamento interno
5. Tratamento de erros local

## üìä Estrutura no n8n

As pastas aparecem organizadas alfabeticamente no n8n:
```
Personal / Sandro Borges / Jana - Aprendizado /
  ‚îú‚îÄ‚îÄ (A) Interface         # 1 Workflow
  ‚îú‚îÄ‚îÄ (B) Normaliza√ß√£o      # 1 Workflow
  ‚îú‚îÄ‚îÄ (C) Processamento     # 1 Workflow
  ‚îú‚îÄ‚îÄ (D) Intelig√™ncia      # 0 Workflows (vazio)
  ‚îú‚îÄ‚îÄ (E) Integra√ß√£o        # 2 Workflows
  ‚îî‚îÄ‚îÄ (F) Observabilidade   # 0 Workflows (vazio)
```

### Estrutura de Arquivos Sugerida
```
/protocolo
  /especificacao
    /(A) Interface
      interface-conexao-webhook (INT-CNX-001).json
      interface-rest-api (INT-API-001).json

    /(B) Normalizacao
      normalizacao-adaptador-contact (NOR-ADP-001).json
      normalizacao-transformer-data (NOR-TRF-001).json

    /(C) Processamento
      processamento-motor-resposta (PRO-MOT-001).json
      processamento-engine-core (PRO-ENG-001).json

    /(D) Inteligencia
      inteligencia-llm-processor (INT-LLM-001).json
      inteligencia-ai-analyzer (INT-ANL-001).json

    /(E) Integracao
      integracao-banco-buscar (INT-BCO-001).json
      integracao-api-externa (INT-API-001).json

    /(F) Observabilidade
      observabilidade-logs-collector (OBS-LOG-001).json
      observabilidade-metrics-tracker (OBS-MET-001).json
```

## üîÑ Fluxo Entre Camadas

```mermaid
graph TB
    subgraph "MESMA CAMADA (sem letra)"
        VAL[VAL:Valida√ß√£o]
        ROT[ROT:Roteamento]
        AGG[AGG:Agrega√ß√£o]

        VAL --> ROT
        ROT --> AGG
    end

    subgraph "ENTRE CAMADAS (com letra)"
        A[A:Interface]
        B[B:Normaliza√ß√£o]
        C[C:Processamento]
        D[D:Intelig√™ncia]
        E[E:Integra√ß√£o]
        F[F:Observabilidade]

        A ==>|executeWorkflow| B
        B ==>|executeWorkflow| C
        C ==>|executeWorkflow| D
        C ==>|executeWorkflow| E
        E -.->|logs| F
    end
```

## üìù Metadados e Estrutura Real

### Exemplo Real do INT-CNX-001
```json
{
  "meta": {
    "instanceId": "13e69768d9105474f419387ffa19b4983ca3540caed4fb88ead28d7a04e5c816",
    "protocol": "ZION-v1.0",
    "pattern": "INT-CNX-001"
  },
  "nodes": [
    {
      "name": "A:Recebe dados conexao",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [896, 752],
      "webhookId": "854abc64-c10f-47fd-bde0-08bb96e74d5f",
      "parameters": {
        "httpMethod": "POST",
        "path": "agents/"
      },
      "notesInFlow": true,
      "notes": "Recebe de conexoes"
    },
    {
      "name": "B:NOR:Conexao > sistema",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [1792, 544],
      "parameters": {
        "workflowId": {
          "value": "Krdi6CaDNjI1Wtln",
          "cachedResultName": "[Jana] (Adaptador) Buscas no banco interno"
        }
      },
      "notesInFlow": true,
      "notes": "Monta o body pra tudo no sistema"
    },
    {
      "name": "VAL:ParametrosValidos",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [1344, 752],
      "parameters": {
        "conditions": {
          "conditions": [{
            "leftValue": "={{ $json.query }}",
            "rightValue": "",
            "operator": {
              "type": "object",
              "operation": "notEmpty"
            }
          }]
        }
      }
    },
    {
      "name": "ERR:Parametros",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [1792, 752],
      "parameters": {
        "errorMessage": "A Jana nao funciona mais com params, somente com query."
      }
    }
  ],
  "stickyNotes": [
    {
      "name": "Sticky Note10",
      "content": "### 1. RECEBE\n- [x] Workflow\n- [ ] Webhook\n- [ ] Rabbit\n- [ ] Evaluations",
      "position": [864, 224],
      "color": 2  // üü† Laranja
    },
    {
      "name": "Sticky Note6",
      "content": "### 5. PROCESSA",
      "position": [1744, -192],
      "color": 3  // üü° Amarelo
    }
  ]
}
```

## ‚úÖ Checklist de Nomenclatura

Para nodes **COM LETRA**:
- [ ] √â um executeWorkflow?
- [ ] Chama workflow de outra camada?
- [ ] Letra corresponde √† camada destino?
- [ ] Nome segue padr√£o `[LETRA]:[CONTEXTO]:[A√á√ÉO]`?

Para nodes **SEM LETRA**:
- [ ] Opera na mesma camada?
- [ ] √â valida√ß√£o, roteamento ou agrega√ß√£o local?
- [ ] Nome segue padr√£o `[TIPO]:[DESCRI√á√ÉO]`?

Para **arquivos**:
- [ ] Nome segue padr√£o `tipo-contexto-descri√ß√£o (C√ìDIGO).json`?
- [ ] C√≥digo √© √∫nico no sistema?
- [ ] Est√° no diret√≥rio correto da camada?

## üöÄ Exemplo de Implementa√ß√£o Completa

### Fluxo Completo INT-CNX-001

```
1. A:Recebe dados conexao (webhook)
   ‚Üì
2. RAS:Execu√ß√£o tratador (salva metadados)
   ‚Üì
3. VAL:ParametrosValidos (if - query existe?)
   ‚îú‚îÄ ‚úÖ Sim
   ‚îÇ   ‚Üì
   ‚îÇ   4. ROT:SelecionaEstrategiaQuery (switch - query ou params?)
   ‚îÇ   ‚îú‚îÄ Query
   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   5. B:NOR:Conexao > sistema (executeWorkflow)
   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   6. B:NOR:Conexao > funcionalidades (executeWorkflow)
   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   7. VAL:Agente deve continuar? (if)
   ‚îÇ   ‚îÇ   ‚îú‚îÄ Sim
   ‚îÇ   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   ‚îÇ   8. VAL:Agente deve processar midia? (if)
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ Sim
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   9. E:INT:Buscar servicos no banco (executeWorkflow)
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   10. E:CNV:Converte midia em texto (executeWorkflow)
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚Üì
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   11. AGG:UnificaMidia (noOp)
   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ N√£o
   ‚îÇ   ‚îÇ   ‚îÇ       ‚Üì
   ‚îÇ   ‚îÇ   ‚îÇ       11. AGG:UnificaMidia (noOp)
   ‚îÇ   ‚îÇ   ‚îî‚îÄ N√£o
   ‚îÇ   ‚îÇ       ‚Üì
   ‚îÇ   ‚îÇ       (fim)
   ‚îÇ   ‚îî‚îÄ Params
   ‚îÇ       ‚Üì
   ‚îÇ       ERR:Parametros (stopAndError)
   ‚îî‚îÄ ‚ùå N√£o
       ‚Üì
       ERR: Conexao inexistente (stopAndError)

12. E:BCO:Busca entidade agente (executeWorkflow)
    ‚Üì
13. E:AGG:Debouncer (executeWorkflow)
    ‚Üì
14. VAL:Dados Validos Processador (if)
    ‚îú‚îÄ Sim
    ‚îÇ   ‚Üì
    ‚îÇ   15. C:CMP:Executa motor de resposta (executeWorkflow)
    ‚îî‚îÄ N√£o
        ‚Üì
        ERR: Invalido (stopAndError)
```

---

*Baseado no workflow INT-CNX-001 implementado em produ√ß√£o - Jana 4.1*